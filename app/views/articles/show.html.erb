<div class="panel">

  <div class="panel-heading clearfix">
    <% if @article.user == current_user %>
      <div class="pull-right clearfix">
        <%= link_to tco('edit'), edit_article_path(@article) %>
        |
        <%= link_to tco('destroy'), @article, method: :delete, data: { confirm: tco(:are_you_sure)} %>
      </div>
    <% end %>
  
    <h1><%= @article.title %></h1>
    <hr />
  </div>

  
  <div class="panel-body">
    <div class="pull-right text-right">
      <div>
        <span><%= tco :created_at %>: <%= @article.created_at %></span>
        <% if @article.created_at != @article.updated_at %>
          <span>|</span>
          <span><%= tco :updated_at %>: <%= @article.updated_at %></span>
          <span>-</span>
          <span><%= link_to "#{tc(:update_histories)}(#{@article.update_histories.size})", update_histories_path(@article) %></span>
        <% end %>
      </div>
      <% @article.tags.each do |tag| %>
        <%= link_to tag.name, articles_by_tag_path(tag.name), class: ["label", "label-default"] %>
      <% end %>
      <span class="dropdown">
        <%= render partial: "users/info_dropdown", locals: {user: @article.user} %>
      </span>
      <%= stock_and_comment_count(@article) %>
      <div>
        <% if @stocked_users.size() > 0 %>
          <%= tc :stocked_users %>
          <% @stocked_users.each do |user| %>
            <span class="dropdown">
              <%= render partial: "users/info_dropdown", locals: {user: user, icon_only: true} %>
            </span>
          <% end %>
        <% end %>
        
        <%# if @stocked_users.size() > 10 %>
          <%#= tco :more_display %>
        <%# end %>
      </div>
      <p>
        <% if @stock %>
          <%= link_to tc('unstock'), @stock, :method => :delete %>
        <% else %>
          <%= link_to tc('stock'), {:controller => "stocks", :article_id => @article.id}, :method => :post %>
        <% end %>
      </p>
    </div>
  </div>

  <div class="panel-body markdown">
    <%= markdown(@article.body).html_safe %>
  </div>
</div>

<p class="lead"><%= tc :comments_title %></p>

<ul class="list-group">
  <% if @article.comments.blank? %>
    <li class="list-group-item">Nothing...</li>
  <% else %>
    <% @article.comments.each do |comment| %>
      <li class="list-group-item">
        <div class="list-group-item-heading">
          <div class="dropdown"><%= render partial: "users/info_dropdown", locals: {user: comment.user} %></div>
          <span class="comment-info pull-right">
            <%= comment.updated_at %>
            <% if comment.user == current_user %> 
              |
              <%= content_tag :a, tco('edit'), class: "comment-edit-link", "data-toggle" => "collapse", "data-target" => "[action='#{comment_path(comment)}']" %>
              |
              <%= link_to tco('destroy'), comment, method: :delete, data: { confirm: tco(:are_you_sure)} %>
            <% end %>
          </span>
        </div>
        <div class="list-group-body markdown">
          <%= markdown(comment.body).html_safe %>
        </div>
        <% if comment.user == current_user %> 
          <%= render 'comments/form', hide: true, comment: comment %>
        <% end %>
      </li>
    <% end %>
  <% end %>
</ul>

<p class="lead"><%= tc :comment_form_title %></p>
<%= render 'comments/form', hide: false, comment: Comment.new %>

<p>
  <%= link_to tco(:back), @pre_accessable_url %>
</p>
